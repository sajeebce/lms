# üìò LMS Subject & Enrollment System Plan

## üéØ Objective
Unify the **Subject Management** system with the **Enrollment (Academic + Public)** logic of the LMS ‚Äî ensuring scalable handling of multi-class subjects (e.g., Math in Class 8 and Class 9) and automated enrollment, payment, and content access.

---

## üß± Core Entities

| Entity | Purpose |
|--------|----------|
| **Stream** | Defines academic track (e.g., Science, Commerce, Arts) |
| **Class** | Defines academic level (e.g., Class 8, Class 9, HSC) |
| **Section** | Subdivision of class (Morning/Evening batches) |
| **Subject** | Global knowledge area (Math, Physics, English, etc.) |
| **Course** | Class + Subject + Stream specific learning unit |
| **Enrollment** | Links students to courses (with payment & access state) |
| **Invoice** | Tracks payment status for enrollment |
| **QuestionBank** | Class + Subject based question storage |

---

## üß© Subject & Course Relationship

### Hierarchy Overview
```
Stream ‚îÄ‚î¨‚îÄ> Class ‚îÄ‚î¨‚îÄ> Section
         ‚îÇ          ‚îî‚îÄ> Course
         ‚îÇ
         ‚îî‚îÄ> Subject ‚îÄ‚î¨‚îÄ> Course
                      ‚îî‚îÄ> QuestionBank
```

### Example
| Stream | Class | Subject | Course | Section |
|---------|--------|----------|---------|----------|
| Science | 9 | Physics | SSC Physics ‚Äì Full Syllabus | Morning |

**Result:** The course links to `streamId=science`, `classId=nine`, and `subjectId=physics`.

---

## ‚öôÔ∏è Database Schema (Simplified Prisma)

```ts
model Stream {
  id        String   @id @default(cuid())
  name      String
  classes   Class[]
}

model Class {
  id        String   @id @default(cuid())
  name      String
  streamId  String?
  stream    Stream?  @relation(fields: [streamId], references: [id])
  sections  Section[]
  courses   Course[]
}

model Section {
  id        String   @id @default(cuid())
  name      String
  classId   String
  class     Class    @relation(fields: [classId], references: [id])
  students  Student[]
  courseSections CourseSection[]
}

model Subject {
  id        String   @id @default(cuid())
  name      String
  code      String?
  description String?
  courses   Course[]
  questionBanks QuestionBank[]
}

model Course {
  id          String   @id @default(cuid())
  title       String
  classId     String
  subjectId   String
  streamId    String?
  price       Float?
  description String?
  class       Class     @relation(fields: [classId], references: [id])
  subject     Subject   @relation(fields: [subjectId], references: [id])
  stream      Stream?   @relation(fields: [streamId], references: [id])
  sections    CourseSection[]
}

model CourseSection {
  id         String   @id @default(cuid())
  courseId   String
  sectionId  String
  course     Course   @relation(fields: [courseId], references: [id])
  section    Section  @relation(fields: [sectionId], references: [id])
}

model Enrollment {
  id          String   @id @default(cuid())
  courseId    String
  studentId   String
  sectionId   String?
  type        String   @default("academic") // or "external"
  status      String   @default("pending_payment")
  invoiceId   String?
  activatedAt DateTime?
  createdAt   DateTime @default(now())
}

model Invoice {
  id          String   @id @default(cuid())
  studentId   String
  amount      Float
  status      String   @default("unpaid")
  paidAt      DateTime?
  items       Json
}

model QuestionBank {
  id         String   @id @default(cuid())
  title      String
  classId    String
  subjectId  String
  streamId   String?
  difficulty String?
  questions  Json
}
```

---

## üéì Internal (Academic) Enrollment Flow

### Steps
1. **Admin creates course** ‚Üí selects Stream, Class, Subject, Section.
2. **System auto-fetches all students** from that section.
3. **Auto Enrollment:**
   ```js
   Enrollment.create({
     courseId: course.id,
     studentId: student.id,
     status: 'pending_payment',
     invoiceId: autoGeneratedInvoice.id
   });
   ```
4. **Auto Invoice:**
   - Item: SSC Physics (Nine Science Morning)
   - Amount: 1500 BDT
   - Status: `Unpaid`
5. **Payment lock:** Course locked until payment done.
6. **Unlock:**
   ```js
   Enrollment.update({
     status: 'active',
     activatedAt: now()
   });
   ```

---

## üåê External (Public) Enrollment Flow

### Path 1 ‚Äì Public Catalog Journey
1. User browses course catalog ‚Üí selects ‚ÄúSSC Physics‚Äù.
2. Clicks **Enroll Now** ‚Üí Registration/Login ‚Üí Chooses section.
3. Creates record:
   ```js
   Enrollment.create({
     courseId: course.id,
     studentId: newStudent.id,
     type: 'external',
     status: 'pending_payment',
     invoiceId: newInvoice.id,
     sectionId: selectedSection.id
   });
   ```
4. Auto invoice ‚Üí payment ‚Üí unlock access.
5. Optional: assign to virtual section for external batches.

### Path 2 ‚Äì Admission Form Flow
1. Student fills `/admission?course=ssc-physics` form.
2. System:
   - Creates student record
   - Assigns section
   - Generates enrollment + invoice
3. Student gets payment link ‚Üí upon success ‚Üí course unlocked.

---

## üß≠ System Logic Summary

| Step | Internal | External |
|------|-----------|-----------|
| Trigger | Admin assigns | Student applies |
| Enrollment Type | `auto-academic` | `manual-public` |
| Invoice | Auto generated | Auto generated |
| Payment | Required | Required |
| Access | Locked until paid | Locked until paid |
| Section | Academic section | Virtual or chosen section |
| RBAC | Student | Student (type: external) |

---

## üß† Example
**Rafi (external student) enrolls in SSC Physics:**
1. Visits `radiusacademy.com/course/ssc-physics`
2. Registers ‚Üí chooses Morning Section
3. System auto creates enrollment + invoice
4. Pays ‚Üí unlocks content
5. Appears in section as external student.

---

## ‚úÖ Recommendations

- Maintain **global Subject table** shared across all classes.
- Keep **Course** as the bridge between **Subject + Class + Stream**.
- Auto-enroll internal students based on assigned Section.
- Allow **Public Enrollments** for marketing and open admission.
- Use **Enrollment type flags** (`academic`, `external`, `trial`).
- Lock course content until invoice is paid.
- Reuse this architecture for **Question Bank**, **Quiz**, and **Reporting** modules.

